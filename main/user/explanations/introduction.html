
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Essential Concepts &#8212; epics-containers.github.io 2023.11.2.dev60+ge7d0972 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=bfcd6b2a"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=30646c52"></script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user/explanations/introduction';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.2';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://epics-containers.github.io/epics-containers.github.io/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'main';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../../_static/k8s-epics2.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Channel Access and Other Protocols" href="net_protocols.html" />
    <link rel="prev" title="Builder2ibek.support Conversion Tool" href="../how-to/builder2ibek.support.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/k8s-epics2.png" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../../_static/k8s-epics2.png" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">EPICS Containers</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer/index.html">
                        Developer Guide
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/epics-containers/epics-containers.github.io/releases">
                    Release Notes
                  </a>
                </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/epics-containers/epics-containers.github.io" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/epics-containers.github.io" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-cube fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer/index.html">
                        Developer Guide
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/epics-containers/epics-containers.github.io/releases">
                    Release Notes
                  </a>
                </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/epics-containers/epics-containers.github.io" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/epics-containers.github.io" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-cube fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/intro.html">Tutorials Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/setup_workstation.html">Set up a Developer Workstation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/create_beamline.html">Create a Beamline Repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/deploy_example.html">Deploying and Managing IOC Instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/create_ioc.html">Create an IOC Instance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/dev_container.html">Developer Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/ioc_changes1.html">Changing the IOC Instance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/ioc_changes2.html">Changing a Generic IOC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/generic_ioc.html">Create a Generic IOC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/debug_generic_ioc.html">Debugging Generic IOC Builds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/test_generic_ioc.html">Testing and Deploying a Generic IOC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/support_module.html">Working with Support Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/setup_k8s.html">Setup a Kubernetes Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/setup_k8s_new_beamline.html">Create a New Kubernetes Beamline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/rtems_setup.html">RTEMS - Creating a File Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/rtems_ioc.html">RTEMS - Deploying an Example IOC</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../how-to/phoebus.html">Viewing Operator Interfaces with Phoebus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/debug.html">Debug an IOC instance locally</a></li>

<li class="toctree-l1"><a class="reference internal" href="../how-to/contributing.html">Contributing to the project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/own_tools.html">Choose Your Developer Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/useful_k8s.html">Kubernetes Additional How To’s</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/ibek-support.html">Updating and Testing ibek-support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/builder2ibek.html">Builder2ibek Conversion Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/builder2ibek.support.html">Builder2ibek.support Conversion Tool</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Essential Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="net_protocols.html">Channel Access and Other Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes_cluster.html">Kubernetes Cluster Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs-structure.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="repositories.html">Source and Registry Locations</a></li>
<li class="toctree-l1"><a class="reference internal" href="ioc-source.html">Dev Container vs Runtime Container</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../reference/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/configuration.html">Configuration for epics-containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/environment.html">The Environment Configuration File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/cli.html">Command Line Interface for IOC Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/ioc_helm_chart.html">IOC Helm Chart Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/k8s_resources.html">Kubernetes Resources in an IOC Instance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/vscode_settings.html">Recommended VSCode Settings</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Essential Concepts</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="essential-concepts">
<span id="essential"></span><h1>Essential Concepts<a class="headerlink" href="#essential-concepts" title="Link to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p><strong>epics-containers</strong> applies modern industry best practice for software
delivery to the management of EPICS IOCs.</p>
<p>There are 5 themes to this strategy:</p>
<dl class="field-list simple">
<dt class="field-odd">Containers<span class="colon">:</span></dt>
<dd class="field-odd"><p>Package IOC software and execute it in a lightweight virtual environment.</p>
</dd>
<dt class="field-even">Kubernetes<span class="colon">:</span></dt>
<dd class="field-even"><p>Centrally orchestrates all IOCs at a facility.</p>
</dd>
<dt class="field-odd">Helm Charts<span class="colon">:</span></dt>
<dd class="field-odd"><p>Deploy IOCs into Kubernetes with version management.</p>
</dd>
<dt class="field-even">Repositories<span class="colon">:</span></dt>
<dd class="field-even"><p>Source, container and helm repositories manage all of the above assets.
No shared file systems required.</p>
</dd>
<dt class="field-odd">Continuous Integration / Delivery<span class="colon">:</span></dt>
<dd class="field-odd"><p>Source repositories automatically build containers and helm charts
delivering them to OCI registries.</p>
</dd>
</dl>
<p>See below for more detail on each of these.</p>
</section>
<section id="concepts">
<h2>Concepts<a class="headerlink" href="#concepts" title="Link to this heading">#</a></h2>
<section id="images-and-containers">
<h3>Images and Containers<a class="headerlink" href="#images-and-containers" title="Link to this heading">#</a></h3>
<p>Containers provide the means to package up IOC software and execute it
in a lightweight virtual environment. These packages are then saved
into public or private image registries such as DockerHub or Github Container
Registry.</p>
<p>The Open Container Initiative (OCI) defines the set of container services
and their APIs such that container images can be interchanged between
different frameworks.</p>
<p>Thus, in this project we develop, build and test our container images
using docker or podman but the images can be run under Kubernetes’ own
container runtime.</p>
<p>This article does a good job of explaining the relationship between docker /
containers and Kubernetes <a class="reference external" href="https://semaphoreci.com/blog/kubernetes-vs-docker">https://semaphoreci.com/blog/kubernetes-vs-docker</a></p>
<p>An important outcome of using containers is that you can alter the
environment inside the container to suit the IOC code, instead of altering the
code to suit your infrastructure. At DLS, this means that we are able to use
vanilla EPICS base and support modules. We no longer require our own
forks of these repositories.</p>
<section id="generic-iocs-and-instances">
<span id="generic-iocs"></span><h4>Generic IOCs and instances<a class="headerlink" href="#generic-iocs-and-instances" title="Link to this heading">#</a></h4>
<p>An important principal of the approach presented here is that an IOC container
image represents a ‘Generic’ IOC. The Generic IOC image is used for all
IOC instances that connect to a given class of device. For example the
Generic IOC image here:
<a class="reference external" href="https://github.com/epics-containers/ioc-adaravis/pkgs/container/ioc-adaravis-linux-runtime">ghcr.io/epics-containers/ioc-adaravis-linux-runtime:2023.10.2</a>
uses the AreaDetector driver ADAravis to connect to GigE cameras.</p>
<p>An IOC instance runs in a container runtime by loading two things:</p>
<ul class="simple">
<li><p>The Generic IOC image passed to the container runtime.</p></li>
<li><p>The IOC instance configuration. This is mapped into the container at
runtime by mounting it into the filesystem. The mount point
for this configuration is always /epics/ioc/config.</p></li>
</ul>
<p>The configuration will bootstrap the unique properties of that instance.
The following contents for the configuration are supported:</p>
<ul class="simple">
<li><p>ioc.yaml: an <strong>ibek</strong> IOC description file which <strong>ibek</strong> will use to generate
st.cmd and ioc.subst.</p></li>
<li><p>st.cmd, ioc.subst: an IOC shell startup script and an optional substitution file.
st.cmd can refer any additional files in the configuration directory.</p></li>
<li><p>start.sh a bash script to fully override the startup of the IOC. start.sh
can refer to any additional files in the configuration directory.</p></li>
</ul>
<p>This approach reduces the number of images required and saves disk. It also
makes for simple configuration management.</p>
<p>Throughout this documentation we will use the terms Generic IOC and
IOC Instance. The word IOC without this context is ambiguous.</p>
</section>
</section>
<section id="kubernetes">
<h3>Kubernetes<a class="headerlink" href="#kubernetes" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://kubernetes.io/">https://kubernetes.io/</a></p>
<p>Kubernetes easily and efficiently manages containers across clusters of hosts.
When deploying an IOC into a Kubernetes cluster, you request the resources
required by the IOC and Kubernetes will then schedule the IOC onto a suitable host.</p>
<p>It builds upon 15 years of experience of running production workloads at
Google, combined with best-of-breed ideas and practices from the community,
since it was open-sourced in 2014.</p>
<p>Today it is by far the dominant orchestration technology for containers.</p>
<p>In this project we use Kubernetes and helm to provide a standard way of
implementing these features:</p>
<ul class="simple">
<li><p>Auto start IOCs when servers come up</p></li>
<li><p>Manually Start and Stop IOCs</p></li>
<li><p>Monitor IOC status and versions</p></li>
<li><p>Deploy versioned IOCs to the beamline</p></li>
<li><p>Rollback to a previous IOC version</p></li>
<li><p>Allocate a server with adequate resources on which to run each IOC</p></li>
<li><p>Failover to another server (for soft IOCs not tied to hardware in a server)</p></li>
<li><p>View the current log</p></li>
<li><p>View historical logs (via graylog or other centralized logging system)</p></li>
<li><p>Connect to an IOC and interact with its shell</p></li>
<li><p>debug an IOC by starting a bash shell inside it’s container</p></li>
</ul>
</section>
<section id="kubernetes-alternative">
<h3>Kubernetes Alternative<a class="headerlink" href="#kubernetes-alternative" title="Link to this heading">#</a></h3>
<p>If you do not have the resources to maintain a Kubernetes cluster then this project
supports installing IOC instances directly into the local docker or podman runtime
on the current server. Where a beamline has multiple servers the distribution of
IOCs across those servers is managed by the user. These tools would replace
Kubernetes and Helm in the technology stack.</p>
<p>If you choose to use this approach then you may find it useful to have another
tool for viewing and managing the set of containers you have deployed across
your beamline servers. There are various solutions for this, one that has
been tested with <strong>epics-containers</strong> is Portainer <a class="reference external" href="https://www.portainer.io/">https://www.portainer.io/</a>.
Portainer is a paid for product
that provides excellent visibility and control of your containers through a
web interface. It is very easy to install.</p>
<p>The downside of this approach is that you will need to manually manage the
resources available to each IOC instance and manually decide which server to
run each IOC on.</p>
</section>
<section id="helm">
<h3>Helm<a class="headerlink" href="#helm" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://helm.sh/">https://helm.sh/</a></p>
<p>Helm is the most popular package manager for Kubernetes applications.</p>
<p>The packages are called Helm Charts. They contain templated YAML files to
define a set of resources to apply to a Kubernetes cluster.</p>
<p>Helm has functions to deploy Charts to a cluster and manage multiple versions
of the chart within the cluster.</p>
<p>It also supports registries for storing version history of charts,
much like docker.</p>
<p>In this project we use Helm Charts to define and deploy IOC instances.
Each beamline (or accelerator domain) has its own git repository that holds
the domain Helm Chart for its IOC Instances. Each IOC instance need only
provide a values.yaml file to override the default values in the domain
Helm Chart and a config folder as described in <a class="reference internal" href="#generic-iocs"><span class="std std-ref">Generic IOCs and instances</span></a>.</p>
<p><strong>epics-containers</strong> does not use helm repositories for storing IOC instances.
Such repositories only hold a zipped version of the chart and a values.yaml file,
and this is seen as redundant when we have a git repository holding the same
information. Instead we provide a command line tool for installing and updating
IOCs. Which performs the following steps:</p>
<ul class="simple">
<li><p>Clone the beamline repository at a specific tag to a temporary folder</p></li>
<li><p>extract the beamline chart and apply the values.yaml to it</p></li>
<li><p>additionally generate a config map from the config folder files</p></li>
<li><p>install the resulting chart into the cluster</p></li>
<li><p>remove the temporary folder</p></li>
</ul>
<p>This means that we don’t store the chart itself but we do store all of the
information required to re-generate it in a version tagged repository.</p>
</section>
<section id="repositories">
<h3>Repositories<a class="headerlink" href="#repositories" title="Link to this heading">#</a></h3>
<p>All of the assets required to manage a
set of IOC Instances for a beamline are held in repositories.</p>
<p>Thus all version control is done via these repositories and no special
locations in a shared filesystem are required.
(The legacy approach at DLS relied heavily on know locations in a
shared filesystem).</p>
<p>In the <strong>epics-containers</strong> examples all repositories are held in the same
github organization. This is nicely contained and means that only one set
of credentials is required to access all the resources.</p>
<p>There are many alternative services for storing these repositories, both
in the cloud and on premises. Below we list the choices we have tested
during the POC.</p>
<p>The 2 classes of repository are as follows:</p>
<dl class="field-list">
<dt class="field-odd">Source Repository<span class="colon">:</span></dt>
<dd class="field-odd"><ul>
<li><p>Holds the source code but also provides the
Continuous Integration actions for testing, building and publishing to
the image / helm repositories.</p>
<p>These have been tested:</p>
<ul class="simple">
<li><p>github</p></li>
<li><p>gitlab (on premises)</p></li>
</ul>
</li>
<li><p>epics-containers defines two classes of source repository:</p>
<ul class="simple">
<li><p>Generic IOC source. Defines how a Generic IOC image is built, this does
not typically include source code, but instead is a set of instructions
for building the Generic IOC image by compiling source from a number
of upstream support module repositories. Boilerplate IOC source code
is also included in the Generic IOC source repository and can be
customized if needed.</p></li>
<li><p>Beamline / Accelerator Domain source. Defines the IOC instances for a
Domain. This includes the IOC boot scripts and
any other configuration required to make the IOC instance unique.
For <strong>ibek</strong> based IOCs, each IOC instance is defined by an <strong>ibek</strong>
yaml file only.</p></li>
</ul>
</li>
</ul>
</dd>
<dt class="field-even">An OCI image repository<span class="colon">:</span></dt>
<dd class="field-even"><ul>
<li><p>Holds the Generic IOC container images and their
dependencies. Also used to hold the helm charts that define the shared
elements between all domains.</p>
<p>The following have been tested:</p>
<ul class="simple">
<li><p>Github Container Registry</p></li>
<li><p>DockerHub</p></li>
<li><p>Google Cloud Container Registry</p></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
<section id="continuous-integration">
<h3>Continuous Integration<a class="headerlink" href="#continuous-integration" title="Link to this heading">#</a></h3>
<p>Our examples all use continuous integration to get from pushed source
to the published images, IOC instances helm charts and documentation.</p>
<p>This allows us to maintain a clean code base that is continually tested for
integrity and also to maintain a direct relationship between source code version
tags and the tags of their built resources.</p>
<p>There are these types of CI:</p>
<dl class="field-list simple">
<dt class="field-odd">Generic IOC source<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>builds a Generic IOC container image</p></li>
<li><p>runs some tests against that image - these will eventually include
system tests that talk to simulated hardware</p></li>
<li><p>publishes the image to github packages (only if the commit is tagged)
or other OCI registry</p></li>
</ul>
</dd>
<dt class="field-even">beamline definition source<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p>prepares a helm chart from each IOC instance definition</p></li>
<li><p>tests that the helm chart is deployable (but does not deploy it)</p></li>
<li><p>locally launches each IOC instance and loads its configuration to
verify that the configuration is valid (no system tests because this
would require talking to real hardware instances).</p></li>
</ul>
</dd>
<dt class="field-odd">documentation source<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>builds the sphinx docs</p></li>
<li><p>publishes it to github.io pages with version tag or branch tag.</p></li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="scope">
<h2>Scope<a class="headerlink" href="#scope" title="Link to this heading">#</a></h2>
<p>This project initially targets x86_64 Linux Soft IOCs and RTEMS IOC running
on MVME5500 hardware. Soft IOCs that require access to hardware on the
server (e.g. USB or PCIe) will be supported by mounting the hardware into
the container (theses IOCS will not support Kubernetes failover).</p>
<p>Other linux architectures could be added to the Kubernetes cluster. We have
tested arm64 native builds and will add this as a supported architecture
in the future.</p>
<p>Python soft IOCs are also supported.</p>
<p>GUI generation for engineering screens will be supported via the PVI project.
See <a class="github reference external" href="https://github.com/epics-containers/pvi">epics-containers/pvi</a>.</p>
</section>
<section id="additional-tools">
<h2>Additional Tools<a class="headerlink" href="#additional-tools" title="Link to this heading">#</a></h2>
<section id="epics-containers-cli">
<h3>epics-containers-cli<a class="headerlink" href="#epics-containers-cli" title="Link to this heading">#</a></h3>
<p>This is the developer’s ‘outside of the container’ helper tool. The command
line entry point is <strong>ec</strong>.</p>
<p>The project is a python package featuring simple command
line functions for deploying, monitoring building and debugging
Generic IOCs and IOC instances. It is a wrapper
around the standard command line tools kubectl, podman/docker, helm, and git
but saves typing and provides help and command line completion. It also
can teach you how to use these tools by showing you the commands it is
running.</p>
<p>See <a class="reference internal" href="../reference/cli.html#cli"><span class="std std-ref">Command Line Interface for IOC Management</span></a> for details.</p>
</section>
<section id="ibek">
<h3><strong>ibek</strong><a class="headerlink" href="#ibek" title="Link to this heading">#</a></h3>
<p>IOC Builder for EPICS and Kubernetes is the developer’s ‘inside the container’
helper tool. It is a python package that is installed into the Generic IOC
container images. It is used:</p>
<ul class="simple">
<li><p>at container build time: to fetch and build EPICS support modules</p></li>
<li><p>at container build time: to generate the IOC source code and compile it</p></li>
<li><p>at container run time: to extract all useful build artifacts into a
runtime image</p></li>
</ul>
<p>See <a class="github reference external" href="https://github.com/epics-containers/ibek">epics-containers/ibek</a>.</p>
</section>
<section id="pvi">
<h3>PVI<a class="headerlink" href="#pvi" title="Link to this heading">#</a></h3>
<p>The Process Variables Interface project is a python package that is installed
inside Generic IOC container images. It is used to give structure to the IOC’s
Process Variables allowing us to:</p>
<ul class="simple">
<li><p>add metadata to the IOCs DB records for use by <a class="reference external" href="https://blueskyproject.io/">Bluesky</a> and <a class="reference external" href="https://github.com/bluesky/ophyd-async">Ophyd</a></p></li>
<li><p>auto generate screens for the device (as bob, adl or edm files)</p></li>
</ul>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../how-to/builder2ibek.support.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Builder2ibek.support Conversion Tool</p>
      </div>
    </a>
    <a class="right-next"
       href="net_protocols.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Channel Access and Other Protocols</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concepts">Concepts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#images-and-containers">Images and Containers</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#generic-iocs-and-instances">Generic IOCs and instances</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kubernetes">Kubernetes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kubernetes-alternative">Kubernetes Alternative</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#helm">Helm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#repositories">Repositories</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#continuous-integration">Continuous Integration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scope">Scope</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-tools">Additional Tools</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#epics-containers-cli">epics-containers-cli</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ibek"><strong>ibek</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pvi">PVI</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/epics-containers/epics-containers.github.io/edit/main/docs/user/explanations/introduction.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/user/explanations/introduction.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>
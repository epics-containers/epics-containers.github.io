


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Kubernetes Cluster Config &mdash; k8s_epics_docs 0.4+1.g4c29311 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/dls-favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Create a new generic IOC image" href="../how-to/create_ioc.html" />
    <link rel="prev" title="Channel Access and Other Protocols" href="net_protocols.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: rgb(7, 43, 93)" >
          

          
            <a href="../index.html" class="icon icon-home"> k8s_epics_docs
          

          
            
            <img src="../_static/dls-logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                main
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  <style>
    /* style mobile top nav to look like main nav */
    .wy-nav-top {
        background: rgb(7, 43, 93)
    }
  </style>
  
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/setup_k8s.html">Setup a Kubernetes Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/create_beamline.html">Create a beamline repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/add_ioc.html">Add an IOC instance to a beamline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/manage_iocs.html">Deploy and Manage IOCs</a></li>
</ul>
<p class="caption"><span class="caption-text">Explanations</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Essential Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="whats_in.html">epics-containers Contents</a></li>
<li class="toctree-l1"><a class="reference internal" href="net_protocols.html">Channel Access and Other Protocols</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Kubernetes Cluster Config</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cluster-options">Cluster Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dls-argus-cluster">DLS Argus Cluster</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#brief-overview-of-dls-argus-cluster">Brief Overview of DLS Argus cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="#beamline-local-cluster-nodes">Beamline Local Cluster Nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hostnetwork-true">hostNetwork = true</a></li>
<li class="toctree-l3"><a class="reference internal" href="#namespaces-and-permissions">Namespaces and Permissions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#taints-and-tolerances">Taints and Tolerances</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how-to/create_ioc.html">Create a new generic IOC image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/generic_iocs.html">Run an IOC without Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/debug.html">Debug an IOC instance locally</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/debug.html#debug-an-ioc-instance-in-kubernetes">Debug an IOC instance in Kubernetes</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/cli.html">Command Line Interface for IOC Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/contributing.html">Contributing</a></li>
</ul>

            
          
  <!-- Include all versions of the docs -->
  <!-- https://holzhaus.github.io/sphinx-multiversion/master/templates.html -->
  
  <p class="caption"><span class="caption-text">Versions</span></p>
  <ul>
    <li><a href="kubernetes_cluster.html">main</a></li>
    <li><a href="../../0.4/explanations/kubernetes_cluster.html">0.4</a></li>
    <li><a href="../../0.3/index.html">0.3</a></li>
    <li><a href="../../0.2/index.html">0.2</a></li>
  </ul>
  

        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">k8s_epics_docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Kubernetes Cluster Config</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/explanations/kubernetes_cluster.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kubernetes-cluster-config">
<h1>Kubernetes Cluster Config<a class="headerlink" href="#kubernetes-cluster-config" title="Permalink to this headline">¶</a></h1>
<div class="section" id="cluster-options">
<h2>Cluster Options<a class="headerlink" href="#cluster-options" title="Permalink to this headline">¶</a></h2>
<p>Three cluster topologies were considered for this project.</p>
<dl class="field-list simple">
<dt class="field-odd">Cluster per beamline</dt>
<dd class="field-odd"><p>This could be as simple as
a single server: the K3S installation described in
<a class="reference internal" href="../tutorials/setup_k8s.html#setup-kubernetes"><span class="std std-ref">Setup a Kubernetes Server</span></a> may be sufficient. The documentation at
<a class="reference external" href="https://rancher.com/docs/k3s/">https://rancher.com/docs/k3s/</a> also details how to make a high availability
cluster, requiring a minimum of 4 servers.
This approach keeps the configuration of the clusters quite straightforward
but at the cost of having multiple separate clusters to maintain. Also
it requires control plane servers for every beamline, whereas a centralized
approach would only need a handful of control plane servers for the entire
facility.</p>
</dd>
<dt class="field-even">Central Facility Cluster</dt>
<dd class="field-even"><p>A central facility cluster that runs
all IOCs on its own nodes would keep everything centralized and provide
economy of scale. However, there are significant issues with routing
Channel Access, PVA and some device protocols to IOCs running in a
different subnet to the beamline. DLS spent some time working around these
issues but eventually abandoned this approach.</p>
</dd>
<dt class="field-odd">Beamline Worker Nodes</dt>
<dd class="field-odd"><p>This approach uses the central
cluster but adds remote beamline nodes located in the beamline itself,
connected to the beamline subnet. This has all the benefits of central
management but is able to overcome the problems with protocol routing.
The DLS argus cluster configuration described below is an example of
how to achieve this.</p>
</dd>
</dl>
</div>
<div class="section" id="dls-argus-cluster">
<span id="argus"></span><h2>DLS Argus Cluster<a class="headerlink" href="#dls-argus-cluster" title="Permalink to this headline">¶</a></h2>
<p><strong>TODO</strong> this section will give details of the topology and special
configuration used by the DLS argus cluster to enable running
IOCs on a Beamline.</p>
<div class="section" id="brief-overview-of-dls-argus-cluster">
<h3>Brief Overview of DLS Argus cluster<a class="headerlink" href="#brief-overview-of-dls-argus-cluster" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="beamline-local-cluster-nodes">
<h3>Beamline Local Cluster Nodes<a class="headerlink" href="#beamline-local-cluster-nodes" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="hostnetwork-true">
<h3>hostNetwork = true<a class="headerlink" href="#hostnetwork-true" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="namespaces-and-permissions">
<h3>Namespaces and Permissions<a class="headerlink" href="#namespaces-and-permissions" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="taints-and-tolerances">
<h3>Taints and Tolerances<a class="headerlink" href="#taints-and-tolerances" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../how-to/create_ioc.html" class="btn btn-neutral float-right" title="Create a new generic IOC image" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="net_protocols.html" class="btn btn-neutral float-left" title="Channel Access and Other Protocols" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Diamond Light Source.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
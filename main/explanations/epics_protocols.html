
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>EPICS Network Protocols in Containers &#8212; epics-containers 4.2.1.dev10+gdacf2af documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=994ea3cb"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=30646c52"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'explanations/epics_protocols';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://epics-containers.github.io/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'main';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="icon" href="../_static/k8s-epics2.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Essential Concepts" href="introduction.html" />
    <link rel="prev" title="About the documentation" href="docs-structure.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="main" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/k8s-epics2.ico" class="logo__image only-light" alt=""/>
    <img src="../_static/k8s-epics2.ico" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">epics-containers</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../how-to.html">
    How-to Guides
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../explanations.html">
    Explanations
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/epics-containers/epics-containers.github.io" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/epics-containers" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../how-to.html">
    How-to Guides
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../explanations.html">
    Explanations
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/epics-containers/epics-containers.github.io" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/epics-containers" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="autosave.html">Autosave for IOCs</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Change Management Manifesto</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="decisions.html">Architectural Decision Records</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="decisions/0001-record-architecture-decisions.html">1. Record architecture decisions</a></li>
<li class="toctree-l2"><a class="reference internal" href="decisions/0002-switched-to-python-copier-template.html">2. Adopt python-copier-template for project structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="decisions/0003-use-substitution-files.html">3. Use of substitution files to generate EPICS Databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="decisions/0004-autosave-req-files.html">4. How to configure autosave for IOCs</a></li>
<li class="toctree-l2"><a class="reference internal" href="decisions/0005-python-scripting.html">5. Use Python for scripting inside and outside containers</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="docs-structure.html">About the documentation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">EPICS Network Protocols in Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Essential Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="ioc-source.html">Dev Container vs Runtime Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes_cluster.html">Kubernetes Cluster Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="net_protocols.html">Channel Access and Other Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="repositories.html">Source and Registry Locations</a></li>
<li class="toctree-l1"><a class="reference internal" href="rootless.html">Rootless vs Rootfull</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../explanations.html" class="nav-link">Explanations</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">EPICS Network Protocols in Containers</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="epics-network-protocols-in-containers">
<h1>EPICS Network Protocols in Containers<a class="headerlink" href="#epics-network-protocols-in-containers" title="Link to this heading">#</a></h1>
<p>When EPICS IOCs run in containers, Channel Access or PVAcess protocols must be made available to clients. There are some challenges around this that are discussed in this page.</p>
<section id="approaches-to-network-protocols">
<h2>Approaches to Network Protocols<a class="headerlink" href="#approaches-to-network-protocols" title="Link to this heading">#</a></h2>
<p>To get clients and servers connected we can use 3 approaches:</p>
<ol class="arabic simple">
<li><p>Run IOC containers in <strong>Host Network</strong>:</p>
<ul class="simple">
<li><p>This is the approach that DLS has adopted for IOCs running in Kubernetes.</p></li>
<li><p>The container uses the host network stack.</p></li>
<li><p>This looks identical to running the IOC on the host machine as far as clients are concerned.</p></li>
<li><p>See a discussion of the reasoning here: <a class="reference internal" href="net_protocols.html"><span class="std std-doc">Channel Access and Other Protocols</span></a></p></li>
<li><p>This reduces the isolation of the container from the host so additional security measures may be needed.</p></li>
</ul>
</li>
<li><p>Use <strong>Port Mapping</strong>:</p>
<ul class="simple">
<li><p>This approach is used in the developer containers defined by <a class="reference external" href="https://github.com/epics-containers/example-services">ioc-template</a></p></li>
<li><p>The container runs in a container network.</p></li>
<li><p>The necessary ports are mapped from the host network to the container network.</p></li>
<li><p>VSCode can do this port mapping automatically when it detects processes binding to ports.</p></li>
<li><p>This approach is good for local development and running tutorials as the mapping can be made to localhost only and PVs can be isolated to the developer’s machine.</p></li>
</ul>
</li>
<li><p>Run the clients in the <strong>same container network</strong> as the IOCs:</p>
<ul class="simple">
<li><p>This approach is used in <a class="reference external" href="https://github.com/epics-containers/example-services">example-services</a>.</p></li>
<li><p><strong>example-services</strong> runs a PVA and a CA gateway in the same container network as the IOCs.</p>
<ul>
<li><p>The gateways use Port Mapping to give access to their own clients.</p></li>
<li><p>The gateways can use any ports and UDP broadcast to communicate with the IOCs.</p></li>
</ul>
</li>
<li><p>If your client is a GUI app, like phoebus, then this may not work as it can be difficult to do X11 forwarding into a rootless container network.</p></li>
</ul>
</li>
</ol>
</section>
<section id="general-observations">
<h2>General Observations<a class="headerlink" href="#general-observations" title="Link to this heading">#</a></h2>
<p>Using Host Network or the same container network for client and host is compatible with both PVA and CA protocols.</p>
<p>For podman and docker networks this is true even for UDP broadcast.</p>
<p>For the majority of Kubernetes CNI’s the broadcast does not work across pods. It is quite possible that broadcast within pods would work as this is equivalent to ‘same container network’. However this would make management of large numbers of IOCs far more of a manual task.</p>
</section>
<section id="channel-access">
<h2>Channel Access<a class="headerlink" href="#channel-access" title="Link to this heading">#</a></h2>
<p>Specification <a class="reference external" href="https://docs.epics-controls.org/en/latest/internal/ca_protocol.html">https://docs.epics-controls.org/en/latest/internal/ca_protocol.html</a>.</p>
<p>Experiments with Channel Access servers running in containers reveal:</p>
<ul class="simple">
<li><p>Port Mapping works for CA including UDP broadcast.</p></li>
<li><p>But UDP broadcast or unicast only works if the container does not remap the port to a different number inside the container.</p></li>
<li><p>Using EPICS_CA_NAME_SERVERS always works with Port Mapping</p></li>
</ul>
</section>
<section id="pv-access">
<h2>PV Access<a class="headerlink" href="#pv-access" title="Link to this heading">#</a></h2>
<p>Specification <a class="reference external" href="https://docs.epics-controls.org/en/latest/pv-access/Protocol-Messages.html">https://docs.epics-controls.org/en/latest/pv-access/Protocol-Messages.html</a>.</p>
<p>Experimentation with PV Access servers running in containers reveal:</p>
<ul class="simple">
<li><p>Port Mapping for PVA using UDP always fails because PVA servers open a new random port for each circuit and this is not NAT friendly.</p></li>
<li><p>Using EPICS_PVA_NAME_SERVERS always works with Port Mapping</p></li>
<li><p>But the client and server must both be PVXS</p></li>
<li><p>To talk to a non PVXS server, a pvagw running in the same container network may be used.</p></li>
</ul>
</section>
<section id="code">
<h2>Code<a class="headerlink" href="#code" title="Link to this heading">#</a></h2>
<p>The following bash scripts can be run to test the assertions made above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

# demo of exposing Channel Access outside of a container

# caRepeater:
#
# note that these experiments ignore the CA_REPEATER_PORT. Typically
# IOCs in containers should also expose 5065 for the CA repeater.
# Because only the first IOC needs to start caRepeater, and that one process
# binds to 5065, it turns out that caRepeater continues to work as expected.
# (caRepeater can go down if the IOC that started it goes down, but it will get
# restarted by the next IOC startup.)

cmd=&#39;-dit --rm --name test ghcr.io/epics-containers/ioc-template-example-runtime:4.1.0&#39;

check () {
    podman run $args $env $ports $cmd &gt; /dev/null
    podman logs -f test | grep -q -m 1 &quot;iocInit&quot;

    if caget EXAMPLE:IBEK:SUM &amp;&gt;/dev/null; then
        echo &quot;CA Success&quot;
    else
        echo &quot;CA Failure&quot;
    fi

    podman stop test &amp;&gt; /dev/null; sleep 1
    echo ---
}

(
    echo no ports, network host, broadcast
    ports=
    args=&quot;--network host&quot;
    check
    # the default sledgehammer approach works like native IOCs
)

# I guess broadcasts don&#39;t go to the loopback
(
    echo 5064, broadcast: FAILURE
    ports=&quot;-p 5064:5064 -p 5064:5064/udp&quot;
    check
)

(
    echo 5064 no UDP, broadcast: FAILURE
    ports=&quot;-p 5064:5064&quot;
    check
)

(
    echo 5064, unicast
    export EPICS_CA_ADDR_LIST=&quot;localhost&quot;
    ports=&quot;-p 5064:5064 -p 5064:5064/udp&quot;
    check
)

(
    echo 5064 no UDP, unicast: FAILURE
    export EPICS_CA_ADDR_LIST=&quot;localhost&quot;
    ports=&quot;-p 5064:5064&quot;
    check
    # EPICS_CA_ADDR_LIST uses UDP Unicast
)

# NOTE: binding to localhost means that only the local host clients
# can see the IOC. This is useful for testing without exposing the IOC
# on the whole subnet.
(
    echo 5064, broadcast, localhost: FAILURE
    ports=&quot;-p 127.0.0.1:5064:5064 -p 127.0.0.1:5064:5064/udp&quot;
    check
    # why does this fail? - I guess broadcasts do not go to localhost
)

(
    echo 5064, unicast, localhost
    export EPICS_CA_ADDR_LIST=&quot;localhost&quot;
    ports=&quot;-p 127.0.0.1:5064:5064 -p 127.0.0.1:5064:5064/udp&quot;
    check
)

(
    echo  8064, broadcast
    export EPICS_CA_SERVER_PORT=8064
    env=&quot;-e EPICS_CA_SERVER_PORT=8064&quot;
    ports=&quot;-p 8064:8064 -p 8064:8064/udp&quot;
    check
)

(
    echo  8064, unicast, localhost
    export EPICS_CA_ADDR_LIST=&quot;localhost&quot; EPICS_CA_SERVER_PORT=8064
    env=&quot;-e EPICS_CA_SERVER_PORT=8064&quot;
    ports=&quot;-p 127.0.0.1:8064:8064 -p 127.0.0.1:8064:8064/udp&quot;
    check
)

# remapping the ports does not work!
(
    echo  8064:5064, broadcast: FAILURE
    export EPICS_CA_SERVER_PORT=8064
    ports=&quot;-p 8064:5064 -p 8064:5064/udp&quot;
    check
)

(
    echo  8064:5064, unicast, localhost: FAILURE
    export EPICS_CA_ADDR_LIST=&quot;localhost&quot; EPICS_CA_SERVER_PORT=8064
    ports=&quot;-p 127.0.0.1:8064:5064 -p 127.0.0.1:8064:5064/udp&quot;
    check
)

(
    echo  5064 no UDP, NAME_SERVER, localhost
    export EPICS_CA_NAME_SERVERS=&quot;localhost:5064&quot;
    ports=&quot;-p 127.0.0.1:5064:5064&quot;
    check
)

(
    echo  8064:5064 no UDP, NAME_SERVER, localhost
    export EPICS_CA_NAME_SERVERS=&quot;localhost:8064&quot;
    ports=&quot;-p 127.0.0.1:8064:5064&quot;
    check
)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

# demo of exposing PV Access outside of a container

# requires a venv with p4p installed

pvget=&#39;
from p4p.client.thread import Context

Context(&quot;pva&quot;).get(&quot;EXAMPLE:IBEK:SUM&quot;, timeout=0.5)
&#39;

cmd=&#39;-dit --rm --name test ghcr.io/epics-containers/ioc-template-example-runtime:4.1.0&#39;

check () {
    podman run $args $env $ports $cmd &gt; /dev/null
    podman logs -f test | grep -q -m 1 &quot;iocInit&quot;

    if python -c &quot;$pvget&quot; 2&gt;/dev/null; then
        echo &quot;PVA Success&quot;
    else
        echo &quot;PVA Failure&quot;
    fi

    podman stop test &amp;&gt; /dev/null
    echo ---
}

(
    echo no ports, network host, broadcast
    ports=
    args=&quot;--network host&quot;
    check
    # the default sledgehammer approach works like native IOCs
)

# PVA fails for broadcast and unicast because the client creates a new random
# port for the server to make the TCP circuit but that is not NAT friendly.
(
    echo 5075, broadcast: FAILURE
    ports=&quot;-p 5075:5075 -p 5075:5075/udp&quot;
    check
)

(
    echo 5075, unicast: FAILURE
    export EPICS_PVA_ADDR_LIST=&quot;localhost&quot;
    ports=&quot;-p 5075:5075 -p 5075:5075/udp&quot;
    check
)

# NAME SERVER uses a single TCP connection and is compatible with NAT
#
# IMPORTANT - for this to work, both ends of the conversation must be pvxs.
# Thus to talk to ADPvaPlugin requires a pvagw running in the same container
# network to proxy the traffic
(
    echo 5075, NAME SERVER
    export EPICS_PVA_NAME_SERVERS=&quot;localhost:5075&quot;
    ports=&quot;-p 5075:5075&quot;
    check
)

(
    echo 8057:5075, NAME SERVER
    export EPICS_PVA_NAME_SERVERS=&quot;localhost:8075&quot;
    ports=&quot;-p 8075:5075&quot;
    check
)
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="docs-structure.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">About the documentation</p>
      </div>
    </a>
    <a class="right-next"
       href="introduction.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Essential Concepts</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#approaches-to-network-protocols">Approaches to Network Protocols</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-observations">General Observations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#channel-access">Channel Access</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pv-access">PV Access</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code">Code</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/epics-containers/epics-containers.github.io/edit/main/docs/explanations/epics_protocols.md">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/explanations/epics_protocols.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>
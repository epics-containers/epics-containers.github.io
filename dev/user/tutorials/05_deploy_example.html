

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Deploy The Example IOC &#8212; epics-containers.github.io 0.9.dev78+ga566af9 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user/tutorials/05_deploy_example';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://epics-containers.github.io/epics-containers.github.io/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        </script>
    <link rel="shortcut icon" href="../../_static/k8s-epics2.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Testing Changes to IOC instances" href="05a_ioc_changes.html" />
    <link rel="prev" title="Create a Beamline Repository" href="04_create_beamline.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/k8s-epics2.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/k8s-epics2.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
    <p class="title logo__title">epics-containers.github.io</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer/index.html">
                        Developer Guide
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/epics-containers/epics-containers.github.io/releases">
                    Release Notes
                  </a>
                </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/epics-containers/epics-containers.github.io" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/epics-containers.github.io" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-cube"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      dev  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer/index.html">
                        Developer Guide
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/epics-containers/epics-containers.github.io/releases">
                    Release Notes
                  </a>
                </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/epics-containers/epics-containers.github.io" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/epics-containers.github.io" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-cube"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      dev  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="00_intro.html">Tutorials Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_setup_workstation.html">Setup a Developer Workstation</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_devcontainer.html">Setup the Devcontainer</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_setup_k8s.html">Setup a Kubernetes Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_create_beamline.html">Create a Beamline Repository</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Deploy The Example IOC</a></li>
<li class="toctree-l1"><a class="reference internal" href="05a_ioc_changes.html">Testing Changes to IOC instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_generic_ioc.html">Working with Generic IOCs</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_support_module.html">Working with Support Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="08_new_support.html">Creating a New Support Module</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../how-to/add_ioc.html">Add an IOC instance to a beamline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/create_ioc.html">Create a new generic IOC image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/run_iocs.html">Run an IOC without Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/debug.html">Debug an IOC instance locally</a></li>

<li class="toctree-l1"><a class="reference internal" href="../how-to/contributing.html">Contributing to the project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/own_tools.html">Choose Your Developer Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/useful_k8s.html">Kubernetes Additional How To’s</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../explanations/introduction.html">Essential Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/whats_in.html">epics-containers Contents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/net_protocols.html">Channel Access and Other Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/kubernetes_cluster.html">Kubernetes Cluster Config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/docs-structure.html">About the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/repositories.html">Source and Registry Locations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/cli-tools.html">CLI Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/k8s-resources.html">Kubernetes Resources in an IOC Instance</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../reference/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/cli.html">Command Line Interface for IOC Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Index</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Deploy The Example IOC</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="deploy-the-example-ioc">
<h1>Deploy The Example IOC<a class="headerlink" href="#deploy-the-example-ioc" title="Permalink to this heading">#</a></h1>
<section id="examine-the-example-ioc-instance">
<h2>Examine the Example IOC Instance<a class="headerlink" href="#examine-the-example-ioc-instance" title="Permalink to this heading">#</a></h2>
<p>In the previous tutorial we created an example beamline source project called
<code class="docutils literal notranslate"><span class="pre">bl01t</span></code> and added it to our VSCode workspace. Go into VSCode and take
a look at the files in the project.</p>
<p>Take a look in the folder iocs/bl0t-ea-ioc-01. This contains a helm chart
that defines the example IOC instance. To add a new IOC instance you could
copy this folder and rename it to bl0t-ea-ioc-02 for example. You would then
need to make a few changes, so here is a description of the files in this
folder:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Chart.yaml</span></code> - this is the helm chart definition file. It contains
metadata about the chart and a list of dependencies. Most of this file
can be left as is for all IOC instances. But you do need to change these
fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> - the unique name for the chart and the IOC instance it represents.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Description</span></code> - a short description of the IOC instance.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">values.yaml</span></code> - this is the helm values file. It contains the values that
are substituted in to the helm templates when the helm chart is built. Most
of the values that go into an IOC instance chart will be drawn from
domain defaults which can be found in the folder <code class="docutils literal notranslate"><span class="pre">beamline-chart</span></code>. Values
you need to supply here are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">base_image</span></code> - the generic IOC image to use for this IOC instance. A
generic IOC image contains all the necessary support modules for a
given class of device and a compiled IOC binary with all those modules
linked. The IOC instance we are defining in a helm chart provides the startup
script and possibly database that makes this IOC instance unique. In this
case the generic IOC is for the area-detector simulator device.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prefix</span></code> - the EPICS PV prefix for this IOC instance. This will set an
environment variable IOC_PREFIX which declares the prefix for the IOC’s
devIOCStats records. You can leave this value out if you use the ioc
name as the prefix, but in this case we have used an uppercase version of
IOC name as the prefix.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">templates/ioc.yaml</span></code> this is the master template for this helm chart,
it pulls in all the other templates from our dependencies. This file
has to appear here but is boilerplate and should not need to be changed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">config</span></code> this folder contains any files unique to this IOC instance. At
runtime on the cluster when the generic IOC image is running it will see
these files as mounted into the folder <code class="docutils literal notranslate"><span class="pre">/repos/epics/ioc/config</span></code>.
In this case we have an EPICS startup script <code class="docutils literal notranslate"><span class="pre">st.cmd</span></code> only
and the default behaviour is just to run the IOC binary and pass it
<code class="docutils literal notranslate"><span class="pre">st.cmd</span></code>.</p>
<p>To see how the Generic IOC makes use of the config folder take a look
at <a class="reference external" href="https://github.com/epics-containers/ioc-template/blob/main/ioc/start.sh">this bash script</a> which runs on Generic IOC startup.</p>
</li>
</ul>
</section>
<section id="deploy-the-ioc-instance-to-kubernetes">
<h2>Deploy the IOC Instance to Kubernetes<a class="headerlink" href="#deploy-the-ioc-instance-to-kubernetes" title="Permalink to this heading">#</a></h2>
<p>For the moment we are going to work with the original bl01t-ea-ioc-01 as is and
have a go at deploying and interacting with it.</p>
<p>For this section we will be making use of the epics-containers-cli tool. This makes
it easier to interact with kubernetes and helm from the command line and is
described in more detail here: <a class="reference internal" href="../reference/cli.html#cli"><span class="std std-ref">Command Line Interface for IOC Management</span></a>.</p>
<p>You will need a working Kubernetes cluster for most of the rest of the
tutorials. You can verify that it is working by asking for a list of IOCs
running in your default domain as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ec<span class="w"> </span>ps
</pre></div>
</div>
<p>You should see some headings and an empty list as you have not yet started an
IOC Instance.</p>
<p>The following command will deploy the example IOC instance to your cluster:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ec<span class="w"> </span>ioc<span class="w"> </span>deploy<span class="w"> </span>bl01t-ea-ioc-01<span class="w"> </span><span class="m">23</span>.4.1
</pre></div>
</div>
<p>Note that this is looking for the IOC’s helm chart in your OCI helm registry
you delivered the IOC helm chart to the registry when you made a release of
the beamline repo in the previous tutorial. You must supply a version number
that exists. If you do not recall the version number you used,
you can use the following command to list the versions available in your
registry:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ec<span class="w"> </span>ioc<span class="w"> </span>versions<span class="w"> </span>bl01t-ea-ioc-01
</pre></div>
</div>
<p>As the deployment is progressing you could use the following command to
monitor the progress (hit ctrl-C to stop following the logs):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ec<span class="w"> </span>ioc<span class="w"> </span>logs<span class="w"> </span>bl01t-ea-ioc-01<span class="w"> </span>-f
</pre></div>
</div>
<p>Note there may be a little delay while the cluster pulls the generic IOC
image from the GitHub container registry.</p>
<p>Once the IOC is running you can find out the IP address of the pod it is
running in with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ec<span class="w"> </span>ps<span class="w"> </span>-w
</pre></div>
</div>
<p>This will show you the status of the IOC instance and the IP address of the
pod it is running in. In a real beamline setup the IOCs would run in the same
subnet as your workstation so you would not care about the IP address. But
for the example you may need to do the following to let our EPICS clients
know where to look for PVs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">EPICS_CA_ADDR_LIST</span><span class="o">=</span>ip_address_of_pod
<span class="nb">export</span><span class="w"> </span><span class="nv">EPICS_PVA_ADDR_LIST</span><span class="o">=</span>ip_address_of_pod
</pre></div>
</div>
<p>epics-containers does not yet have any provision for EPICS operator interfaces.
For this example we have hand crafted some EDM screens to control and monitor
the test IOC.</p>
<p>You can now launch the client applications as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./blxxi-ea-ioc-01-gui.sh
c2dv<span class="w"> </span>--pv<span class="w"> </span>BL01T-EA-TST-01:IMAGE
</pre></div>
</div>
<p>Now make sure the AreaDetector is Acquiring by clicking Start if needed on
the CAM screen. Next click on Auto to scale the
black and white thresholds on the C2D viewer. You should see something like the
following images.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you launch edm or c2dv for the first time you
will see container images downloading, for an explanation of this see
<a class="reference internal" href="../explanations/cli-tools.html"><span class="doc">CLI Tools</span></a></p>
</div>
<img alt="../../_images/edm_sim.png" class="align-center" src="../../_images/edm_sim.png" />
<img alt="../../_images/c2dv.png" class="align-center" src="../../_images/c2dv.png" />
</section>
<section id="learning-about-helm-and-kubernetes-manifests">
<h2>Learning about Helm and Kubernetes Manifests<a class="headerlink" href="#learning-about-helm-and-kubernetes-manifests" title="Permalink to this heading">#</a></h2>
<p>It is instructive to see what helm is doing when you deploy the example IOC.</p>
<p>Helm uses templates to generate YAML Kubernetes Manifest which defines a set
of resources. It applies this manifest to the cluster using kubectl.</p>
<p>To inspect the kubernetes manifest that is created when we deploy the example
IOC you can use the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ec<span class="w"> </span>ioc<span class="w"> </span>template<span class="w"> </span>iocs/bl01t-ea-ioc-01
</pre></div>
</div>
<p>This is expanding the local helm chart in the iocs folder and using
its <code class="docutils literal notranslate"><span class="pre">templates/ioc.yaml</span></code> plus the templates in helm-ioc-lib. These templates
are expanded using the values in the <code class="docutils literal notranslate"><span class="pre">values.yaml</span></code> file and also
<code class="docutils literal notranslate"><span class="pre">beamline-chart/values.yaml</span></code> and finally the default <code class="docutils literal notranslate"><span class="pre">values.yaml</span></code> file
in the helm-ioc-lib.</p>
<p>For a description of the key resources we create in this Kubernetes manifest
see <a class="reference internal" href="../explanations/k8s-resources.html"><span class="doc">Kubernetes Resources in an IOC Instance</span></a>.</p>
</section>
<section id="managing-iocs">
<h2>Managing IOCs<a class="headerlink" href="#managing-iocs" title="Permalink to this heading">#</a></h2>
<p>IOCs running in Kubernetes can be managed using the <code class="docutils literal notranslate"><span class="pre">ec</span></code> command.</p>
<section id="starting-and-stopping-iocs">
<h3>Starting and Stopping IOCs<a class="headerlink" href="#starting-and-stopping-iocs" title="Permalink to this heading">#</a></h3>
<p>To stop / start  the example IOC:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ec<span class="w"> </span>ioc<span class="w"> </span>stop<span class="w"> </span>bl01t-ea-ioc-01
ec<span class="w"> </span>ioc<span class="w"> </span>start<span class="w"> </span>bl01t-ea-ioc-01
</pre></div>
</div>
</section>
<section id="monitoring-and-interacting-with-an-ioc-shell">
<h3>Monitoring and interacting with an IOC shell<a class="headerlink" href="#monitoring-and-interacting-with-an-ioc-shell" title="Permalink to this heading">#</a></h3>
<p>To attach to the ioc shell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ec<span class="w"> </span>ioc<span class="w"> </span>attach<span class="w"> </span>bl01t-ea-ioc-01
</pre></div>
</div>
<p>Use the command sequence ctrl-P then ctrl-Q to detach or ctrl-D to restart the
IOC and detach.</p>
<p>TODO: I’m having issues with the shell eating the ^P^Q sequences so
at present you can only detach from the IOC by killing the terminal or
using ^D.</p>
<p>To run a bash shell inside the IOC container:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ec<span class="w"> </span>ioc<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>bl01t-ea-ioc-01
</pre></div>
</div>
<p>Once you have a shell inside the container you can inspect the following
folders:</p>
<table class="table">
<tbody>
<tr class="row-odd"><td><p>ioc code</p></td>
<td><p>repos/epics/ioc</p></td>
</tr>
<tr class="row-even"><td><p>support modules</p></td>
<td><p>repos/epics/support</p></td>
</tr>
<tr class="row-odd"><td><p>epics binaries</p></td>
<td><p>repos/epics/epics-base</p></td>
</tr>
</tbody>
</table>
</section>
<section id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Permalink to this heading">#</a></h3>
<p>To get the current logs for the example IOC:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ec<span class="w"> </span>ioc<span class="w"> </span>logs<span class="w"> </span>bl01t-ea-ioc-01
</pre></div>
</div>
<p>Or follow the IOC log until you hit ctrl-C:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ec<span class="w"> </span>ioc<span class="w"> </span>logs<span class="w"> </span>bl01t-ea-ioc-01<span class="w"> </span>-f
</pre></div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="04_create_beamline.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Create a Beamline Repository</p>
      </div>
    </a>
    <a class="right-next"
       href="05a_ioc_changes.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Testing Changes to IOC instances</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-the-example-ioc-instance">Examine the Example IOC Instance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deploy-the-ioc-instance-to-kubernetes">Deploy the IOC Instance to Kubernetes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-about-helm-and-kubernetes-manifests">Learning about Helm and Kubernetes Manifests</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#managing-iocs">Managing IOCs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#starting-and-stopping-iocs">Starting and Stopping IOCs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monitoring-and-interacting-with-an-ioc-shell">Monitoring and interacting with an IOC shell</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logging">Logging</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  
  <div class="tocsection editthispage">
    <a href="https://github.com/epics-containers/epics-containers.github.io/edit/dev/docs/user/tutorials/05_deploy_example.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../_sources/user/tutorials/05_deploy_example.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner"></div>
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>